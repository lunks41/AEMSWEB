<div class="modal fade" id="addLaunchServiceTariffModal" tabindex="-1" aria-labelledby="addLaunchServiceTariffModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addLaunchServiceTariffModalLabel">Add Tariff</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="launchserviceTarifform">
                    <div class="card mb-3">
                        <div class="card-header bg-primary text-white">Tariff Details</div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="mb-1">
                                        <label for="launchservice_cmb_customer" class="form-label">Customer <span class="text-danger">*</span></label>
                                        <select id="launchservice_cmb_customer" style="width: 100%"></select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-1">
                                        <label for="launchservice_cmb_port" class="form-label">Port <span class="text-danger">*</span></label>
                                        <select id="launchservice_cmb_port" style="width: 100%"></select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-1">
                                        <label for="launchservice_cmb_task" class="form-label">Task <span class="text-danger">*</span></label>
                                        <select id="launchservice_cmb_task" style="width: 100%"></select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-1">
                                        <label for="launchservice_cmb_chagre" class="form-label">Charge <span class="text-danger">*</span></label>
                                        <select id="launchservice_cmb_chagre" style="width: 100%"></select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-1">
                                        <label for="launchservice_cmb_uom" class="form-label">UOM <span class="text-danger">*</span></label>
                                        <select id="launchservice_cmb_uom" style="width: 100%"></select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-1">
                                        <label for="launchservice_cmb_slabuom" class="form-label">Type <span class="text-danger">*</span></label>
                                        <select id="launchservice_cmb_slabuom" style="width: 100%"></select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-1">
                                        <label for="launchservice_cmb_currency" class="form-label">Currency <span class="text-danger">*</span></label>
                                        <select id="launchservice_cmb_currency" style="width: 100%"></select>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="mb-1">
                                        <label for="basicrate" class="control-label">Basic Rate</label>
                                        <input type="number" class="form-control" id="basicrate" placeholder="Basic Rate" value="0.000">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-1">
                                        <label for="minunit" class="control-label">Min Unit</label>
                                        <input type="number" class="form-control" id="minunit" placeholder="Min Unit" value="0.000">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-1">
                                        <label for="maxunit" class="control-label">Max Unit</label>
                                        <input type="number" class="form-control" id="maxunit" placeholder="Max Unit" value="0.000">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-1">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="isAdditional">
                                            <label class="form-check-label" for="isAdditional">Is Additional</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-1">
                                        <label for="additionalunit" class="control-label">Additional Unit</label>
                                        <input type="number" class="form-control" id="additionalunit" placeholder="Additional Unit" value="0.000">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-1">
                                        <label for="additionalrate" class="control-label">Additional Rate</label>
                                        <input type="number" class="form-control" id="additionalrate" placeholder="Additional Rate" value="0.000">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-1">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="isActive">
                                            <label class="form-check-label" for="isActive">Is Active</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="mb-1">
                                        <label class="control-label">Remarks</label>
                                        <textarea class="form-control" rows="2"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Audit Fields -->
                    <div class="accordion mt-3" id="auditAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#auditCollapse">
                                    Audit Details
                                </button>
                            </h2>
                            <div id="auditCollapse" class="accordion-collapse collapse">
                                <div class="accordion-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label class="form-label">Created By</label>
                                            <p id="freshwatercreateBy" class="form-control-plaintext"></p>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Created Date</label>
                                            <p id="freshwatercreateDate" class="form-control-plaintext"></p>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Modified By</label>
                                            <p id="freshwatereditBy" class="form-control-plaintext"></p>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Modified Date</label>
                                            <p id="freshwatereditDate" class="form-control-plaintext"></p>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Edit Version</label>
                                            <p id="freshwatereditVersion" class="form-control-plaintext"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <!-- Action Buttons -->
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Clear</button>
                <button type="button" class="btn btn-primary">Save & New</button>
                <button type="submit" class="btn btn-success">Save & Close</button>
            </div>
        </div>
    </div>
</div>

<style>
    .modal-xl {
        max-width: 1200px;
    }

    .form-control:read-only {
        background-color: #f8f9fa;
    }

    .form-check {
        margin-bottom: 1rem;
    }
</style>

<script>
    function saveCommonTariff() {

     let tariffData = {
         TariffId: parseInt($('#tariffId').val()) || 0,
         RateType: 'LaunchService',
         TaskId: parseInt($('#taskId').val()) || 0,
         ChargeId: parseInt($('#chargeId').val()) || 0,
         PortId: parseInt($('#portId').val()) || 0,
         CustomerId: parseInt($('#customerId').val()) || 0,
         CurrencyId: parseInt($('#currencyId').val()) || 0,
         UomId: parseInt($('#uomId').val()) || 0,
         SlabUomId: parseInt($('#slabUomId').val()) || 0,
         VisaTypeId: 0,
         FromPlace: 0,
         ToPlace:  0,
         DisplayRate: 0,
         BasicRate: parseFloat($('#basicRate').val()) || 0,
         MinUnit: parseFloat($('#minUnit').val()) || 0,
         MaxUnit: parseFloat($('#maxUnit').val()) || 0,
         IsAdditional: $('#isAdditional').prop('checked'),
         AdditionalUnit: parseFloat($('#additionalUnit').val()) || 0,
         AdditionalRate: parseFloat($('#additionalRate').val()) || 0,
         PrepaymentPercentage: 0,
         IsPrepayment: 0,
         ItemNo: 0,
         Remarks: $('#remarks').val()?.trim() || '',
         IsActive: $('#isActive').prop('checked')
     };

     console.log("Tariff Data:", tariffData);

     // Validate mandatory fields
     if (!tariffData.RateType) {
         alert('Rate Type, Task Name, and Charge Name are required!');
         return;
     }

     // AJAX call to save the tariff
     $.ajax({
         url: '@Url.Action("SaveTariff", "Tariff", new { area = "Project" })',
         type: "POST",
         data: JSON.stringify({ tariff: tariffData, companyId }), // Tariff data with companyId
         contentType: "application/json",
         success: function (response) {
             if (response.success) {
                 // Reload the grid and reset the form on success
                 loadTariffGrid();
                 clearTariffForm();
                 $('#addTariffModal').modal('hide');
                 alert("Tariff saved successfully!");
             } else {
                 // Show error message if the save was unsuccessful
                 alert(response.message || "Failed to save tariff. Please try again.");
             }
         },
         error: function (xhr) {
             // Handle server/network errors
             alert("Error: " + (xhr.responseJSON?.message || "An unexpected error occurred. Please try again later."));
         }
     });
 }
</script>